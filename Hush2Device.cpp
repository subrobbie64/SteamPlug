#include "Hush2Device.h"
#include "ButtplugConfig.h"
#include <algorithm>

HushDevice::HushDevice(ButtplugConfig& config) : ButtplugDevice(config), _buttplugService(), _rxCharac(), _txCharac(), _deviceId(), _readBatteryAt(0) {
	System::CreateSema(&_runningCommand, 1);
}

HushDevice::~HushDevice() {
	System::DestroySema(&_runningCommand);
}

bool HushDevice::onConnectionEstablished() {
	const ButtplugDeviceDefinition* buttplugDefinition = &HUSH_DEVICE[_config.getHushType()];
	int Res;
	if ((Res = _wclGattClient.FindService(buttplugDefinition->serviceId, _buttplugService)) != WCL_E_SUCCESS)
		debug("FindService failed 0x%X!\n", Res);
	else if ((Res = _wclGattClient.FindCharacteristic(_buttplugService, buttplugDefinition->txCharacteristicId, _txCharac)) != WCL_E_SUCCESS)
		debug("FindCharacteristic (TX) Error: 0x%X", Res);
	else if ((Res = _wclGattClient.FindCharacteristic(_buttplugService, buttplugDefinition->rxCharacteristicId, _rxCharac)) != WCL_E_SUCCESS)
		debug("FindCharacteristic (RX) Error: 0x%X", Res);
	else if ((Res = _wclGattClient.Subscribe(_rxCharac)) != WCL_E_SUCCESS)
		debug("Subscribe failed Error 0x%X!\n", Res);
	else if ((Res = _wclGattClient.WriteClientConfiguration(_rxCharac, true, goNone)) != WCL_E_SUCCESS)
		debug("WriteClientConfiguration->SubscribeForNotifications failed 0x%X\n", Res);
	else if (!issueCommand("DeviceType;"))
		debug("Unable to query device type\n");
	else
		return true; // Success
	return false;
}

bool HushDevice::issueCommand(const char* commandString) {
	if (System::WaitSema(&_runningCommand, 1000) == SEMA_TIMEOUT)
		log("WARN: Timeout waiting for previous command to complete\n");
	const int Res = _wclGattClient.WriteCharacteristicValue(_txCharac, (const unsigned char*)commandString, (unsigned int)strlen(commandString), plNone, wkWithoutResponse);
	if (Res == WCL_E_SUCCESS)
		return true;

	log("WriteCharacteristicValue error 0x%X\n", Res);
	disconnect();
	System::SignalSema(&_runningCommand);
	return false;
}

void HushDevice::onClientCharacteristicChanged(const unsigned char* const Value, const unsigned long Length) {
	System::SignalSema(&_runningCommand);

	std::string response((const char*)Value, Length);
	if (isalpha(response[0]) && (response[1] == ':')) {
		if (response[0] != 'Z')
			log("WARN: This does not look like a Hush device\n");
		_deviceId = response;
		issueCommand("Battery;");
	} else if (isdigit(response[0]) && (Length <= 4)) {
		_batteryLevel = std::stoi(response);
		_status = BT_CONNECTED;
	} else if (response.compare("POWEROFF;") == 0) {
		disconnect();
	} else if (response.compare("OK;") == 0) {
		if (_readBatteryAt < System::GetMicros()) {
			issueCommand("Battery;");
			_readBatteryAt = System::GetMicros() + CHECK_BATTERY_INTERVAL_MILLIS * 1000;
		}
	} else if (response[0] == 's') {
		debug("BP sent error %s\n", response.c_str());
		systhread_t thread = System::CreateThread(&HushDevice::retryHandlerFunc, this);
		System::CloseThread(thread);
	} else
		log("Unknown BP response! (Length = %d): %s\n", Length, response.c_str());
}

void HushDevice::setVibrate(unsigned char effectiveVibrationPercent) {
	char commandBuffer[16];
	_effectiveVibrationPercent = effectiveVibrationPercent;
	int hushVibrateSetting = std::clamp((_effectiveVibrationPercent * MAX_VIBRATION_SETTING + 99) / 100, 0, MAX_VIBRATION_SETTING);
	sprintf(commandBuffer, "Vibrate:%d;", hushVibrateSetting);
	issueCommand(commandBuffer);
}

bool HushDevice::isValidType(int type) {
	return (type >= 0) && (type < NUM_HUSH_DEVICES);
}

const std::string& HushDevice::getDeviceId() const {
	return _deviceId;
}

void HushDevice::retryHandler() {
	System::Sleep(RETRY_DELAY_MILLIS);
	char commandBuffer[16];
	int hushVibrateSetting = std::clamp((_effectiveVibrationPercent * MAX_VIBRATION_SETTING + 99) / 100, 0, MAX_VIBRATION_SETTING);
	sprintf(commandBuffer, "Vibrate:%d;", hushVibrateSetting);
	issueCommand(commandBuffer);
}

threadReturn WINAPI HushDevice::retryHandlerFunc(void* arg) {
	((HushDevice*)arg)->retryHandler();
	return THREAD_RETURN;
}

const int HushDevice::RETRY_DELAY_MILLIS = 50;
const int HushDevice::CHECK_BATTERY_INTERVAL_MILLIS = 15000; // 15 seconds

const int HushDevice::MAX_VIBRATION_SETTING = 20;

const ButtplugDeviceDefinition HushDevice::HUSH_DEVICE[] = {
	{{ false, 0, { 0x0000fff0, 0x0000, 0x1000, { 0x80, 0x00, 0x00, 0x80, 0x5f, 0x9b, 0x34, 0xfb }}},
	  { false, 0, { 0x0000fff2, 0x0000, 0x1000, { 0x80, 0x00, 0x00, 0x80, 0x5f, 0x9b, 0x34, 0xfb }}},
	  { false, 0, { 0x0000fff1, 0x0000, 0x1000, { 0x80, 0x00, 0x00, 0x80, 0x5f, 0x9b, 0x34, 0xfb }}}},
	{{ false, 0, { 0x6e400001, 0xb5a3, 0xf393, { 0xe0, 0xa9, 0xe5, 0x0e, 0x24, 0xdc, 0xca, 0x9e }}},
	  { false, 0, { 0x6e400002, 0xb5a3, 0xf393, { 0xe0, 0xa9, 0xe5, 0x0e, 0x24, 0xdc, 0xca, 0x9e }}},
	  { false, 0, { 0x6e400003, 0xb5a3, 0xf393, { 0xe0, 0xa9, 0xe5, 0x0e, 0x24, 0xdc, 0xca, 0x9e }}}},
	{{ false, 0, { 0x50300001, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300002, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300003, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x57300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x57300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x57300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x5a300001, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x5a300002, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x5a300003, 0x0024, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x50300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x53300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x53300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x53300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x5a300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x5a300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x5a300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4f300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4f300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4f300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x42300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x42300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x42300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x43300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x43300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x43300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4c300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4c300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4c300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4c410001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4c410002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4c410003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x56300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x56300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x56300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x58300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x58300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x58300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x52300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x52300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x52300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x46300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x46300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x46300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x50300011, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300012, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x50300013, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4a300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4a300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4a300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x45440001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45440002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45440003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x45420001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45420002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45420003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x54300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x54300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x54300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x45490001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45490002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45490003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4e300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4e300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4e300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x45410001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45410002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45410003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x51300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x51300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x51300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x45460001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45460002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x45460003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x454c0001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x454c0002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x454c0003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x55300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x55300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x55300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x53440001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x53440002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x53440003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x48300001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x48300002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x48300003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x46530001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x46530002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x46530003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x42410001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x42410002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x42410003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x43410001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x43410002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x43410003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x4f430001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4f430002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x4f430003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
	{{ false, 0, { 0x455a0001, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x455a0002, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}},
	  { false, 0, { 0x455a0003, 0x0023, 0x4bd4, { 0xbb, 0xd5, 0xa6, 0x92, 0x0e, 0x4c, 0x56, 0x53 }}}},
};

const int HushDevice::NUM_HUSH_DEVICES = sizeof(HUSH_DEVICE) / sizeof(HUSH_DEVICE[0]);

